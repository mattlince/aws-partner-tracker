 <!-- Deal Modal -->
    <div id="dealModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="dealModalTitle">Add New Deal</h2>
                <span class="close" onclick="closeModal('dealModal')">&times;</span>
            </div>
            <form id="dealForm">
                <input type="hidden" id="dealId" name="id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="dealName">Deal Name:</label>
                        <input type="text" id="dealName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="dealValue">Deal Value ($):</label>
                        <input type="text" id="dealValue" name="value" placeholder="250000" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dealContact">Contact:</label>
                        <select id="dealContact" name="contactId" required>
                            <option value="">Select Contact</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dealTeam">Team:</label>
                        <select id="dealTeam" name="team" required>
                            <option value="">Select Team</option>
                            ${Object.keys(teamConfigs).map(teamId => 
                                `<option value="${teamId}">${teamConfigs[teamId].name}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dealStage">Stage:</label>
                        <select id="dealStage" name="stage" required>
                            ${dealStages.map(stage => 
                                `<option value="${stage.id}">${stage.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dealProbability">Probability (%):</label>
                        <input type="number" id="dealProbability" name="probability" min="0" max="100" value="25">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dealCloseDate">Expected Close Date:</label>
                        <input type="date" id="dealCloseDate" name="closeDate" required>
                    </div>
                    <div class="form-group">
                        <label for="dealType">Deal Type:</label>
                        <input type="text" id="dealType" name="type" placeholder="PPA, Migration, Integration">
                    </div>
                </div>
                <div class="form-group">
                    <label for="dealDescription">Description:</label>
                    <textarea id="dealDescription" name="description" placeholder="Brief description of the opportunity..."></textarea>
                </div>
                <div class="form-group">
                    <label for="dealNextSteps">Next Steps:</label>
                    <textarea id="dealNextSteps" name="nextSteps" placeholder="What are the next actions for this deal..."></textarea>
                </div>
                <button type="submit" class="btn-primary">Save Deal</button>
            </form>
        </div>
    </div>

    <!-- Touchpoint Modal -->
    <div id="touchpointModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="touchpointModalTitle">Log Touchpoint</h2>
                <span class="close" onclick="closeModal('touchpointModal')">&times;</span>
            </div>
            <form id="touchpointForm">
                <input type="hidden" id="touchpointId" name="id">
                <input type="hidden" id="touchpointContactId" name="contactId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="touchpointContact">Contact:</label>
                        <input type="text" id="touchpointContact" readonly style="background: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label for="touchpointType">Type:</label>
                        <select id="touchpointType" name="type" required>
                            <option value="email">Email</option>
                            <option value="call">Phone Call</option>
                            <option value="meeting">Meeting</option>
                            <option value="event">Event</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="demo">Demo</option>
                            <option value="presentation">Presentation</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="touchpointDate">Date:</label>
                        <input type="date" id="touchpointDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="touchpointOutcome">Outcome:</label>
                        <select id="touchpointOutcome" name="outcome">
                            <option value="positive">Positive</option>
                            <option value="neutral">Neutral</option>
                            <option value="negative">Negative</option>
                            <option value="no-response">No Response</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="touchpointSubject">Subject/Topic:</label>
                    <input type="text" id="touchpointSubject" name="subject" placeholder="What was discussed..." required>
                </div>
                <div class="form-group">
                    <label for="touchpointNotes">Notes:</label>
                    <textarea id="touchpointNotes" name="notes" placeholder="Detailed notes about the interaction..."></textarea>
                </div>
                <button type="submit" class="btn-primary">Save Touchpoint</button>
            </form>
        </div>
    </div>

    <!-- Follow-up Modal -->
    <div id="followUpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Schedule Follow-up</h2>
                <span class="close" onclick="closeModal('followUpModal')">&times;</span>
            </div>
            <form id="followUpForm">
                <input type="hidden" id="followUpContactId" name="contactId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="followUpContact">Contact:</label>
                        <input type="text" id="followUpContact" readonly style="background: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label for="followUpType">Type:</label>
                        <select id="followUpType" name="type" required>
                            <option value="call">Phone Call</option>
                            <option value="email">Email</option>
                            <option value="meeting">Meeting</option>
                            <option value="demo">Demo</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="followUpDate">Scheduled Date:</label>
                        <input type="date" id="followUpDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="followUpTime">Time (optional):</label>
                        <input type="time" id="followUpTime" name="time">
                    </div>
                </div>
                <div class="form-group">
                    <label for="followUpSubject">Subject/Purpose:</label>
                    <input type="text" id="followUpSubject" name="subject" placeholder="Purpose of follow-up..." required>
                </div>
                <div class="form-group">
                    <label for="followUpNotes">Notes:</label>
                    <textarea id="followUpNotes" name="notes" placeholder="Any preparation notes or context..."></textarea>
                </div>
                <button type="submit" class="btn-primary">Schedule Follow-up</button>
            </form>
        </div>
    </div>

    <!-- Bulk Actions Modal -->
    <div id="bulkActionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Bulk Actions</h2>
                <span class="close" onclick="closeModal('bulkActionsModal')">&times;</span>
            </div>
            <form id="bulkActionsForm">
                <div class="form-group">
                    <label for="bulkAction">Action:</label>
                    <select id="bulkAction" name="action" required onchange="toggleBulkActionFields(this.value)">
                        <option value="">Select Action</option>
                        <option value="updateTier">Update Tier</option>
                        <option value="addNote">Add Note</option>
                        <option value="scheduleFollowUp">Schedule Follow-up</option>
                    </select>
                </div>
                <div id="bulkTierGroup" class="form-group" style="display: none;">
                    <label for="bulkNewTier">New Tier:</label>
                    <select id="bulkNewTier" name="newTier">
                        <option value="tier1">Tier 1</option>
                        <option value="tier2">Tier 2</option>
                        <option value="tier3">Tier 3</option>
                    </select>
                </div>
                <div id="bulkNoteGroup" class="form-group" style="display: none;">
                    <label for="bulkNote">Note to Add:</label>
                    <textarea id="bulkNote" name="note" placeholder="Note to add to selected contacts..."></textarea>
                </div>
                <div id="bulkFollowUpGroup" class="form-group" style="display: none;">
                    <label for="bulkFollowUpDate">Follow-up Date:</label>
                    <input type="date" id="bulkFollowUpDate" name="followUpDate">
                </div>
                <p style="color: #666; font-size: 0.9em; margin: 10px 0;">
                    Select contacts using checkboxes in the teams table, then choose an action above.
                </p>
                <button type="submit" class="btn-primary">Apply to Selected Contacts</button>
            </form>
        </div>
    </div>

    <!-- Campaign Analytics Modal -->
    <div id="campaignAnalyticsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Campaign Analytics</h2>
                <span class="close" onclick="closeModal('campaignAnalyticsModal')">&times;</span>
            </div>
            <div id="campaignAnalyticsContent">
                <!-- Content populated by renderCampaignAnalytics() -->
            </div>
        </div>
    </div>

    <!-- Deal Details Modal -->
    <div id="dealDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="dealDetailsTitle">Deal Details</h2>
                <span class="close" onclick="closeModal('dealDetailsModal')">&times;</span>
            </div>
            <div id="dealDetailsContent">
                <!-- Content populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Enhanced data structure
        let systemData = {
            lastUpdated: new Date(),
            teams: {},
            deals: [],
            touchpoints: [],
            marketingCampaigns: [],
            analytics: {},
            settings: {
                autoSaveInterval: 30000,
                defaultView: 'teams',
                notifications: true
            }
        };

        // Team configurations
        const teamConfigs = {
            'csc': { name: 'ENT-CSC-C (SWIM)', dm: 'Tara Jayne-O\'Donnell', psm: 'Noah Arling' },
            'isv-genai': { name: 'ISV - GenAI', dm: 'TBD', psm: 'TBD' },
            'isv-data': { name: 'ISV - Data Analytics', dm: 'TBD', psm: 'TBD' },
            'isv-manufacturing': { name: 'ISV - Manufacturing', dm: 'TBD', psm: 'TBD' },
            'smb-east': { name: 'SMB - East', dm: 'TBD', psm: 'TBD' },
            'smb-west': { name: 'SMB - West', dm: 'TBD', psm: 'TBD' },
            'smb-central': { name: 'SMB - Central', dm: 'TBD', psm: 'TBD' },
            'enterprise-global': { name: 'Enterprise - Global', dm: 'TBD', psm: 'TBD' },
            'partner-ops': { name: 'Partner Operations', dm: 'TBD', psm: 'TBD' }
        };

        // Deal stage configuration
        const dealStages = [
            { id: 'prequalified', name: 'Prequalified', color: '#6c757d' },
            { id: 'qualified', name: 'Qualified', color: '#17a2b8' },
            { id: 'proposal-development', name: 'Proposal Development', color: '#ffc107' },
            { id: 'proposal-delivered', name: 'Proposal Delivered', color: '#fd7e14' },
            { id: 'legal', name: 'Legal Review', color: '#6f42c1' },
            { id: 'out-for-signature', name: 'Out for Signature', color: '#20c997' },
            { id: 'signed', name: 'Signed', color: '#28a745' },
            { id: 'deal-won', name: 'Deal Won', color: '#28a745' },
            { id: 'deal-lost', name: 'Deal Lost', color: '#dc3545' }
        ];

        // Enhanced deal management functions
        function addDeal() {
            openModal('dealModal', { mode: 'add' });
        }

        function editDeal(dealId) {
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal) {
                openModal('dealModal', { mode: 'edit', deal });
            }
        }

        function viewDealDetails(dealId) {
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal) {
                const container = document.getElementById('dealDetailsContent');
                const contact = getContactByIdFull(deal.contactId);
                const stage = dealStages.find(s => s.id === deal.stage);
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h3>Deal Information</h3>
                            <p><strong>Name:</strong> ${deal.name}</p>
                            <p><strong>Value:</strong> ${(deal.value/1000).toFixed(0)}K</p>
                            <p><strong>Stage:</strong> <span style="background: ${stage?.color}; color: white; padding: 2px 8px; border-radius: 4px;">${stage?.name}</span></p>
                            <p><strong>Probability:</strong> ${deal.probability}%</p>
                            <p><strong>Close Date:</strong> ${deal.closeDate}</p>
                            <p><strong>Type:</strong> ${deal.type}</p>
                        </div>
                        <div>
                            <h3>Contact Information</h3>
                            <p><strong>Contact:</strong> ${contact?.name || 'Unknown'}</p>
                            <p><strong>Team:</strong> ${teamConfigs[deal.team]?.name || deal.team}</p>
                            <p><strong>Contact Score:</strong> ${contact?.relationshipScore || 'N/A'}</p>
                            <p><strong>Last Contact:</strong> ${contact?.lastContact || 'N/A'}</p>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h3>Description</h3>
                        <p>${deal.description || 'No description provided'}</p>
                    </div>
                    <div style="margin-top: 20px;">
                        <h3>Next Steps</h3>
                        <p>${deal.nextSteps || 'No next steps defined'}</p>
                    </div>
                `;
                
                document.getElementById('dealDetailsTitle').textContent = `Deal Details - ${deal.name}`;
                openModal('dealDetailsModal');
            }
        }

        function handleDealFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const deal = Object.fromEntries(formData.entries());
            
            // Convert value to number
            deal.value = parseFloat(deal.value.replace(/[$,]/g, '')) || 0;
            deal.probability = parseInt(deal.probability) || 0;
            
            if (!deal.id) {
                deal.id = 'deal_' + Date.now();
                deal.createdDate = new Date().toISOString().split('T')[0];
            }
            
            const existingIndex = systemData.deals.findIndex(d => d.id === deal.id);
            if (existingIndex >= 0) {
                systemData.deals[existingIndex] = { ...systemData.deals[existingIndex], ...deal };
                showNotification(`Deal "${deal.name}" updated successfully`);
            } else {
                systemData.deals.push(deal);
                showNotification(`Deal "${deal.name}" added successfully`);
            }
            
            saveData();
            renderDeals();
            calculateMetrics();
            closeModal('dealModal');
        }

        function changeDealStage(dealId, newStage) {
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal) {
                deal.stage = newStage;
                deal.lastUpdated = new Date().toISOString().split('T')[0];
                
                // Auto-update probability based on stage
                const stageProbabilities = {
                    'prequalified': 10,
                    'qualified': 25,
                    'proposal-development': 40,
                    'proposal-delivered': 60,
                    'legal': 75,
                    'out-for-signature': 90,
                    'signed': 95,
                    'deal-won': 100,
                    'deal-lost': 0
                };
                
                deal.probability = stageProbabilities[newStage] || deal.probability;
                
                saveData();
                renderDeals();
                calculateMetrics();
                showNotification(`Deal moved to ${dealStages.find(s => s.id === newStage)?.name}`);
            }
        }

        // Touchpoint management functions
        function logTouchpoint(contactId) {
            const contact = getContactByIdFull(contactId);
            if (contact) {
                document.getElementById('touchpointContactId').value = contactId;
                document.getElementById('touchpointContact').value = contact.name;
                document.getElementById('touchpointDate').value = new Date().toISOString().split('T')[0];
                openModal('touchpointModal', { mode: 'add', contactId });
            }
        }

        function editTouchpoint(touchpointId) {
            const touchpoint = systemData.touchpoints.find(tp => tp.id === touchpointId);
            if (touchpoint) {
                const contact = getContactByIdFull(touchpoint.contactId);
                
                // Populate form
                document.getElementById('touchpointId').value = touchpoint.id;
                document.getElementById('touchpointContactId').value = touchpoint.contactId;
                document.getElementById('touchpointContact').value = contact?.name || 'Unknown';
                document.getElementById('touchpointType').value = touchpoint.type;
                document.getElementById('touchpointDate').value = touchpoint.date;
                document.getElementById('touchpointOutcome').value = touchpoint.outcome || 'positive';
                document.getElementById('touchpointSubject').value = touchpoint.subject;
                document.getElementById('touchpointNotes').value = touchpoint.notes || '';
                
                document.getElementById('touchpointModalTitle').textContent = 'Edit Touchpoint';
                openModal('touchpointModal', { mode: 'edit', touchpoint });
            }
        }

        function handleTouchpointFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const touchpoint = Object.fromEntries(formData.entries());
            
            if (!touchpoint.id) {
                touchpoint.id = 'tp_' + Date.now();
            }
            
            const existingIndex = systemData.touchpoints.findIndex(tp => tp.id === touchpoint.id);
            if (existingIndex >= 0) {
                systemData.touchpoints[existingIndex] = { ...systemData.touchpoints[existingIndex], ...touchpoint };
                showNotification('Touchpoint updated successfully');
            } else {
                systemData.touchpoints.push(touchpoint);
                showNotification('Touchpoint logged successfully');
                
                // Update contact's last contact date
                updateContactLastContact(touchpoint.contactId, touchpoint.date);
            }
            
            saveData();
            renderTouchpoints();
            renderTeams();
            calculateMetrics();
            closeModal('touchpointModal');
        }

        // Follow-up scheduling
        function scheduleFollowUp(contactId) {
            const contact = getContactByIdFull(contactId);
            if (contact) {
                document.getElementById('followUpContactId').value = contactId;
                document.getElementById('followUpContact').value = contact.name;
                
                // Set default date to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('followUpDate').value = tomorrow.toISOString().split('T')[0];
                
                openModal('followUpModal', { contactId });
            }
        }

        function handleFollowUpFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const followUp = Object.fromEntries(formData.entries());
            
            // Create a future touchpoint
            const touchpoint = {
                id: 'fu_' + Date.now(),
                contactId: followUp.contactId,
                type: followUp.type,
                date: followUp.date,
                subject: followUp.subject,
                notes: followUp.notes,
                status: 'scheduled'
            };
            
            systemData.touchpoints.push(touchpoint);
            
            // Update contact's next contact date
            for (let teamId in systemData.teams) {
                const contact = systemData.teams[teamId].find(c => c.id === followUp.contactId);
                if (contact) {
                    contact.nextContact = followUp.date;
                    break;
                }
            }
            
            saveData();
            renderTouchpoints();
            renderTeams();
            calculateMetrics();
            closeModal('followUpModal');
            showNotification('Follow-up scheduled successfully');
        }

        // Bulk actions implementation
        function bulkActions() {
            openModal('bulkActionsModal');
        }

        function toggleBulkActionFields(action) {
            document.getElementById('bulkTierGroup').style.display = action === 'updateTier' ? 'block' : 'none';
            document.getElementById('bulkNoteGroup').style.display = action === 'addNote' ? 'block' : 'none';
            document.getElementById('bulkFollowUpGroup').style.display = action === 'scheduleFollowUp' ? 'block' : 'none';
        }

        function handleBulkActionsSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const action = formData.get('action');
            const selectedContacts = Array.from(document.querySelectorAll('.contact-checkbox:checked'))
                .map(cb => ({ contactId: cb.dataset.contactId, teamId: cb.dataset.teamId }));
            
            if (selectedContacts.length === 0) {
                showNotification('Please select contacts first', 3000, 'warning');
                return;
            }
            
            selectedContacts.forEach(({ contactId, teamId }) => {
                const contact = systemData.teams[teamId]?.find(c => c.id === contactId);
                if (contact) {
                    switch (action) {
                        case 'updateTier':
                            contact.tier = formData.get('newTier');
                            break;
                        case 'addNote':
                            contact.notes = (contact.notes || '') + '\n' + formData.get('note');
                            break;
                        case 'scheduleFollowUp':
                            contact.nextContact = formData.get('followUpDate');
                            break;
                    }
                }
            });
            
            saveData();
            renderTeams();
            calculateMetrics();
            closeModal('bulkActionsModal');
            showNotification(`Bulk action applied to ${selectedContacts.length} contacts`);
        }

        // Campaign analytics
        function campaignAnalytics() {
            openModal('campaignAnalyticsModal');
            renderCampaignAnalytics();
        }

        function renderCampaignAnalytics() {
            const container = document.getElementById('campaignAnalyticsContent');
            if (!container) return;

            const analytics = systemData.marketingCampaigns.map(campaign => {
                const responseRate = campaign.metrics?.sent > 0 ? 
                    ((campaign.responses?.length || 0) / campaign.metrics.sent * 100).toFixed(1) : 0;
                const openRate = campaign.metrics?.sent > 0 ? 
                    ((campaign.metrics.opened || 0) / campaign.metrics.sent * 100).toFixed(1) : 0;
                
                return {
                    ...campaign,
                    responseRate,
                    openRate
                };
            });

            container.innerHTML = `
                <table class="rep-table">
                    <thead>
                        <tr>
                            <th>Campaign</th>
                            <th>Type</th>
                            <th>Sent</th>
                            <th>Opened</th>
                            <th>Responses</th>
                            <th>Open Rate</th>
                            <th>Response Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${analytics.map(campaign => `
                            <tr>
                                <td><strong>${campaign.name}</strong></td>
                                <td>${campaign.type}</td>
                                <td>${campaign.metrics?.sent || 0}</td>
                                <td>${campaign.metrics?.opened || 0}</td>
                                <td>${campaign.responses?.length || 0}</td>
                                <td>${campaign.openRate}%</td>
                                <td>${campaign.responseRate}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Utility functions
        function getContactByIdFull(contactId) {
            for (let teamId in systemData.teams) {
                const contact = systemData.teams[teamId].find(c => c.id === contactId);
                if (contact) return { ...contact, teamId };
            }
            return null;
        }

        function updateContactLastContact(contactId, date) {
            for (let teamId in systemData.teams) {
                const contact = systemData.teams[teamId].find(c => c.id === contactId);
                if (contact) {
                    contact.lastContact = date;
                    break;
                }
            }
        }

        function showAnalytics() {
            showTab('analytics');
        }

        function editCampaign(campaignId) {
            showNotification(`Campaign editing for ${campaignId} coming soon`, 3000, 'info');
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Partner Management System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(45deg, #232F3E, #FF9900);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .last-updated {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        .quick-actions {
            position: absolute;
            top: 15px;
            left: 20px;
            display: flex;
            gap: 10px;
        }
        .quick-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.3s ease;
        }
        .quick-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .metric-card:hover { transform: translateY(-3px); }
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .metric-label {
            color: #666;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .tabs {
            display: flex;
            background: #e9ecef;
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
        }
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: transparent;
            border: none;
            font-size: 0.9em;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .tab.active {
            background: white;
            border-bottom: 3px solid #FF9900;
            font-weight: bold;
            color: #232F3E;
        }
        .tab:hover:not(.active) {
            background: #f8f9fa;
        }
        .tab-content {
            display: none;
            padding: 20px;
        }
        .tab-content.active { display: block; }
        .team-section {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        .team-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #232F3E;
        }
        .team-stats {
            display: flex;
            gap: 15px;
            font-size: 0.8em;
            color: #666;
        }
        .controls-section {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .search-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            width: 200px;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .rep-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            font-size: 0.85em;
        }
        .rep-table th {
            background: #232F3E;
            color: white;
            padding: 10px 6px;
            text-align: left;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .rep-table td {
            padding: 8px 6px;
            border-bottom: 1px solid #eee;
            font-size: 0.85em;
            vertical-align: top;
        }
        .rep-table tbody tr:hover {
            background: #f8f9fa;
        }
        .editable {
            background: transparent;
            border: 1px solid transparent;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
            min-height: 20px;
        }
        .editable:hover {
            background: #f8f9fa;
            border-color: #ddd;
        }
        .editable:focus {
            outline: none;
            border-color: #FF9900;
            background: white;
        }
        .status-badge {
            padding: 3px 6px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-block;
            margin: 1px;
        }
        .status-badge:hover { transform: scale(1.05); }
        .status-tier1 { background: #d4edda; color: #155724; }
        .status-tier2 { background: #fff3cd; color: #856404; }
        .status-tier3 { background: #f8d7da; color: #721c24; }
        .status-hot { background: #ff6b6b; color: white; }
        .status-warm { background: #feca57; color: #333; }
        .status-cold { background: #74b9ff; color: white; }
        .relationship-score {
            display: inline-block;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            text-align: center;
            line-height: 25px;
            color: white;
            font-weight: bold;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .relationship-score:hover { transform: scale(1.1); }
        .score-5 { background: #28a745; }
        .score-4 { background: #17a2b8; }
        .score-3 { background: #ffc107; color: #000; }
        .score-2 { background: #fd7e14; }
        .score-1 { background: #dc3545; }
        .action-btn {
            background: #FF9900;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75em;
            transition: all 0.3s ease;
            margin: 1px;
        }
        .action-btn:hover { 
            background: #e68900; 
            transform: translateY(-1px);
        }
        .action-btn.secondary {
            background: #6c757d;
        }
        .action-btn.secondary:hover {
            background: #5a6268;
        }
        .action-btn.success {
            background: #28a745;
        }
        .action-btn.success:hover {
            background: #218838;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover { color: #000; }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #232F3E;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .btn-primary {
            background: #FF9900;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        .btn-primary:hover {
            background: #e68900;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        .deals-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #eee;
        }
        .deal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .deal-item:last-child {
            border-bottom: none;
        }
        .touchpoint-list {
            max-height: 150px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 4px;
            padding: 8px;
        }
        .touchpoint-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 0.8em;
            border-bottom: 1px solid #eee;
        }
        .marketing-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .marketing-tag {
            background: #e9ecef;
            color: #495057;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            cursor: pointer;
        }
        .marketing-tag.sent {
            background: #d1ecf1;
            color: #0c5460;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                padding: 15px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .rep-table {
                font-size: 0.75em;
            }
            .rep-table th, .rep-table td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="quick-actions">
                <button class="quick-btn" onclick="openModal('quickAdd')">+ Quick Add</button>
                <button class="quick-btn" onclick="exportAllData()">Export All</button>
                <button class="quick-btn" onclick="showAnalytics()">Analytics</button>
            </div>
            <div class="last-updated">Last Updated: <span id="lastUpdated"></span></div>
            <h1>AWS Partner Management System</h1>
            <p>Master Dashboard for 9 Teams • 51 AMs • $2.9M Annual Target</p>
        </div>

        <div class="dashboard">
            <div class="metric-card" onclick="showMetricDetail('engagement')">
                <div class="metric-value" style="color: #28a745;" id="engagementRate">73%</div>
                <div class="metric-label">Engagement Rate</div>
            </div>
            <div class="metric-card" onclick="showMetricDetail('pipeline')">
                <div class="metric-value" style="color: #17a2b8;" id="pipelineValue">$1.2M</div>
                <div class="metric-label">Active Pipeline</div>
            </div>
            <div class="metric-card" onclick="showMetricDetail('deals')">
                <div class="metric-value" style="color: #ffc107;" id="activeDeals">18</div>
                <div class="metric-label">Active Deals</div>
            </div>
            <div class="metric-card" onclick="showMetricDetail('touchpoints')">
                <div class="metric-value" style="color: #fd7e14;" id="weeklyTouchpoints">47</div>
                <div class="metric-label">Weekly Touchpoints</div>
            </div>
            <div class="metric-card" onclick="showMetricDetail('marketing')">
                <div class="metric-value" style="color: #6f42c1;" id="marketingCampaigns">12</div>
                <div class="metric-label">Active Campaigns</div>
            </div>
            <div class="metric-card" onclick="showMetricDetail('coverage')">
                <div class="metric-value" style="color: #20c997;" id="coverageRatio">4.2x</div>
                <div class="metric-label">Pipeline Coverage</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('teams')">All Teams</button>
            <button class="tab" onclick="showTab('deals')">Active Deals</button>
            <button class="tab" onclick="showTab('touchpoints')">Touchpoint Tracker</button>
            <button class="tab" onclick="showTab('marketing')">Marketing Campaigns</button>
            <button class="tab" onclick="showTab('analytics')">Analytics</button>
            <button class="tab" onclick="showTab('settings')">Settings</button>
        </div>

        <div id="teams" class="tab-content active">
            <div class="controls-section">
                <div class="search-controls">
                    <input type="text" class="search-input" placeholder="Search contacts..." id="searchInput">
                    <select class="filter-select" id="teamFilter">
                        <option value="">All Teams</option>
                        <option value="csc">ENT-CSC-C (SWIM)</option>
                        <option value="isv-genai">ISV - GenAI</option>
                        <option value="isv-data">ISV - Data Analytics</option>
                        <option value="isv-manufacturing">ISV - Manufacturing</option>
                        <option value="smb-east">SMB - East</option>
                        <option value="smb-west">SMB - West</option>
                        <option value="smb-central">SMB - Central</option>
                        <option value="enterprise-global">Enterprise - Global</option>
                        <option value="partner-ops">Partner Operations</option>
                    </select>
                    <select class="filter-select" id="tierFilter">
                        <option value="">All Tiers</option>
                        <option value="tier1">Tier 1</option>
                        <option value="tier2">Tier 2</option>
                        <option value="tier3">Tier 3</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="openModal('addContact')">+ Add Contact</button>
                    <button class="action-btn" onclick="openModal('addTeam')">+ Add Team</button>
                    <button class="action-btn secondary" onclick="bulkActions()">Bulk Actions</button>
                </div>
            </div>

            <div id="teamsContainer">
                <!-- Teams will be dynamically populated here -->
            </div>
        </div>

        <div id="deals" class="tab-content">
            <div class="controls-section">
                <div class="search-controls">
                    <input type="text" class="search-input" placeholder="Search deals..." id="dealsSearch">
                    <select class="filter-select" id="stageFilter">
                        <option value="">All Stages</option>
                        <option value="prospect">Prospect</option>
                        <option value="qualified">Qualified</option>
                        <option value="proposal">Proposal</option>
                        <option value="negotiation">Negotiation</option>
                        <option value="closed-won">Closed Won</option>
                        <option value="closed-lost">Closed Lost</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="openModal('addDeal')">+ Add Deal</button>
                    <button class="action-btn secondary" onclick="exportDeals()">Export Deals</button>
                </div>
            </div>
            
            <div class="deals-section">
                <h3>Active Opportunities Pipeline</h3>
                <div id="dealsContainer">
                    <!-- Deals will be populated here -->
                </div>
            </div>
        </div>

        <div id="touchpoints" class="tab-content">
            <div class="controls-section">
                <div class="search-controls">
                    <input type="date" class="search-input" id="touchpointDateFrom">
                    <input type="date" class="search-input" id="touchpointDateTo">
                    <select class="filter-select" id="touchpointType">
                        <option value="">All Types</option>
                        <option value="email">Email</option>
                        <option value="call">Phone Call</option>
                        <option value="meeting">Meeting</option>
                        <option value="event">Event</option>
                        <option value="linkedin">LinkedIn</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="openModal('addTouchpoint')">+ Log Touchpoint</button>
                    <button class="action-btn secondary" onclick="scheduleFollowUp()">Schedule Follow-up</button>
                </div>
            </div>
            
            <div id="touchpointsContainer">
                <!-- Touchpoints will be populated here -->
            </div>
        </div>

        <div id="marketing" class="tab-content">
            <div class="controls-section">
                <div class="search-controls">
                    <select class="filter-select" id="campaignFilter">
                        <option value="">All Campaigns</option>
                        <option value="webinar">Webinars</option>
                        <option value="whitepaper">Whitepapers</option>
                        <option value="case-study">Case Studies</option>
                        <option value="newsletter">Newsletter</option>
                        <option value="event">Events</option>
                        <option value="demo">Product Demos</option>
                    </select>
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="planned">Planned</option>
                        <option value="active">Active</option>
                        <option value="sent">Sent</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="openModal('addCampaign')">+ New Campaign</button>
                    <button class="action-btn secondary" onclick="campaignAnalytics()">Campaign Analytics</button>
                </div>
            </div>
            
            <div id="marketingContainer">
                <!-- Marketing campaigns will be populated here -->
            </div>
        </div>

        <div id="analytics" class="tab-content">
            <div id="analyticsContainer">
                <!-- Analytics dashboard will be populated here -->
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div id="settingsContainer">
                <!-- Settings will be populated here -->
            </div>
        </div>
    </div>

    <!-- Enhanced Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="contactModalTitle">Contact Details</h2>
                <span class="close" onclick="closeModal('contactModal')">&times;</span>
            </div>
            <form id="contactForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="contactName">Name:</label>
                        <input type="text" id="contactName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="contactRole">Role:</label>
                        <input type="text" id="contactRole" name="role" value="AM">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="contactTeam">Team:</label>
                        <select id="contactTeam" name="team" required>
                            <option value="csc">ENT-CSC-C (SWIM)</option>
                            <option value="isv-genai">ISV - GenAI</option>
                            <option value="isv-data">ISV - Data Analytics</option>
                            <option value="isv-manufacturing">ISV - Manufacturing</option>
                            <option value="smb-east">SMB - East</option>
                            <option value="smb-west">SMB - West</option>
                            <option value="smb-central">SMB - Central</option>
                            <option value="enterprise-global">Enterprise - Global</option>
                            <option value="partner-ops">Partner Operations</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contactGeo">Geography:</label>
                        <input type="text" id="contactGeo" name="geo">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="contactTier">Tier:</label>
                        <select id="contactTier" name="tier">
                            <option value="tier3">Tier 3 - Prospect</option>
                            <option value="tier2">Tier 2 - Active Partner</option>
                            <option value="tier1">Tier 1 - Strategic Partner</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="relationshipScore">Relationship Score:</label>
                        <select id="relationshipScore" name="relationshipScore">
                            <option value="1">1 - Cold/No Response</option>
                            <option value="2">2 - Initial Contact</option>
                            <option value="3">3 - Engaged</option>
                            <option value="4">4 - Strong Partnership</option>
                            <option value="5">5 - Strategic Alliance</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lastContact">Last Contact:</label>
                        <input type="date" id="lastContact" name="lastContact">
                    </div>
                    <div class="form-group">
                        <label for="nextContact">Next Planned Contact:</label>
                        <input type="date" id="nextContact" name="nextContact">
                    </div>
                </div>
                <div class="form-group">
                    <label for="pipelineValue">Pipeline Value:</label>
                    <input type="text" id="pipelineValue" name="pipelineValue" placeholder="$0">
                </div>
                <div class="form-group">
                    <label for="customers">Key Customers (comma-separated):</label>
                    <textarea id="customers" name="customers" placeholder="Customer A, Customer B, Customer C..."></textarea>
                </div>
                <div class="form-group">
                    <label for="nextSteps">Next Steps:</label>
                    <textarea id="nextSteps" name="nextSteps" placeholder="Enter planned next actions..."></textarea>
                </div>
                <div class="form-group">
                    <label for="notes">Notes:</label>
                    <textarea id="notes" name="notes" placeholder="Meeting notes, key discussion points, preferences..."></textarea>
                </div>
                <button type="submit" class="btn-primary">Save Contact</button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Enhanced data structure
        let systemData = {
            lastUpdated: new Date(),
            teams: {},
            deals: [],
            touchpoints: [],
            marketingCampaigns: [],
            analytics: {},
            settings: {
                autoSaveInterval: 30000,
                defaultView: 'teams',
                notifications: true
            }
        };

        // Team configurations
        const teamConfigs = {
            'csc': { name: 'ENT-CSC-C (SWIM)', dm: 'Tara Jayne-O\'Donnell', psm: 'Noah Arling' },
            'isv-genai': { name: 'ISV - GenAI', dm: 'TBD', psm: 'TBD' },
            'isv-data': { name: 'ISV - Data Analytics', dm: 'TBD', psm: 'TBD' },
            'isv-manufacturing': { name: 'ISV - Manufacturing', dm: 'TBD', psm: 'TBD' },
            'smb-east': { name: 'SMB - East', dm: 'TBD', psm: 'TBD' },
            'smb-west': { name: 'SMB - West', dm: 'TBD', psm: 'TBD' },
            'smb-central': { name: 'SMB - Central', dm: 'TBD', psm: 'TBD' },
            'enterprise-global': { name: 'Enterprise - Global', dm: 'TBD', psm: 'TBD' },
            'partner-ops': { name: 'Partner Operations', dm: 'TBD', psm: 'TBD' }
        };

        // Initialize system
        function initializeSystem() {
            // Initialize teams if empty
            Object.keys(teamConfigs).forEach(teamId => {
                if (!systemData.teams[teamId]) {
                    systemData.teams[teamId] = [];
                }
            });
            
            // Load sample data if first time
            if (Object.values(systemData.teams).every(team => team.length === 0)) {
                loadSampleData();
            }
            
            updateLastUpdated();
            renderTeams();
            renderDeals();
            renderTouchpoints();
            renderMarketing();
            renderAnalytics();
            calculateMetrics();
            
            // Set up auto-save
            setInterval(saveData, systemData.settings.autoSaveInterval);
            
            // Add event listeners
            setupEventListeners();
        }

        function loadSampleData() {
            // Sample CSC team data
            systemData.teams.csc = [
                {
                    id: 'demaree',
                    name: 'Demaree Barton',
                    role: 'AM',
                    geo: 'HQ1',
                    tier: 'tier1',
                    relationshipScore: 4,
                    lastContact: '2025-06-10',
                    nextContact: '2025-06-20',
                    pipelineValue: '$85K',
                    customers: ['Tech Corp', 'Innovation Labs'],
                    nextSteps: 'Joint account review scheduled',
                    notes: 'Strong relationship, responsive to outreach',
                    touchpoints: [],
                    deals: [],
                    marketingStatus: {}
                },
                {
                    id: 'lars',
                    name: 'Lars Branvold',
                    role: 'AM',
                    geo: 'HQ1',
                    tier: 'tier1',
                    relationshipScore: 4,
                    lastContact: '2025-06-08',
                    nextContact: '2025-06-18',
                    pipelineValue: '$120K',
                    customers: ['Manufacturing Co', 'Industrial Systems'],
                    nextSteps: 'VMware migration opportunity discussion',
                    notes: 'Interested in cloud migration solutions',
                    touchpoints: [],
                    deals: [],
                    marketingStatus: {}
                },
                {
                    id: 'will',
                    name: 'Will Desmond',
                    role: 'AM',
                    geo: 'HQ1',
                    tier: 'tier1',
                    relationshipScore: 4,
                    lastContact: '2025-06-05',
                    nextContact: '2025-06-15',
                    pipelineValue: '$95K',
                    customers: ['Enterprise Solutions', 'Global Tech'],
                    nextSteps: 'PPA discussion and proposal',
                    notes: 'Interested in Partner Program Agreement',
                    touchpoints: [],
                    deals: [],
                    marketingStatus: {}
                }
            ];

            // Sample ISV GenAI team data
            systemData.teams['isv-genai'] = [
                {
                    id: 'helen',
                    name: 'Helen Har Theisen',
                    role: 'AM',
                    geo: 'Remote',
                    tier: 'tier3',
                    relationshipScore: 1,
                    lastContact: '2025-06-09',
                    nextContact: '2025-06-19',
                    pipelineValue: '$0',
                    customers: [],
                    nextSteps: 'Initial outreach and introduction',
                    notes: 'New contact, focus on GenAI solutions',
                    touchpoints: [],
                    deals: [],
                    marketingStatus: {}
                },
                {
                    id: 'luca',
                    name: 'Luca Doan',
                    role: 'AM',
                    geo: 'Remote',
                    tier: 'tier3',
                    relationshipScore: 2,
                    lastContact: '2025-06-09',
                    nextContact: '2025-06-16',
                    pipelineValue: '$25K',
                    customers: ['AI Startup'],
                    nextSteps: 'Demo scheduled for GenAI platform',
                    notes: 'Interested in AI/ML solutions',
                    touchpoints: [],
                    deals: [],
                    marketingStatus: {}
                }
            ];

            // Sample deals
            systemData.deals = [
                {
                    id: 'deal1',
                    name: 'Enterprise PPA - Manufacturing Co',
                    contactId: 'lars',
                    team: 'csc',
                    type: 'PPA',
                    value: 450000,
                    stage: 'proposal',
                    probability: 75,
                    closeDate: '2025-07-30',
                    description: 'Large enterprise PPA for manufacturing client',
                    nextSteps: 'Final proposal review with client executive team'
                },
                {
                    id: 'deal2',
                    name: 'GenAI Platform Integration',
                    contactId: 'luca',
                    team: 'isv-genai',
                    type: 'Integration',
                    value: 175000,
                    stage: 'qualified',
                    probability: 45,
                    closeDate: '2025-09-01',
                    description: 'AI/ML platform integration for startup',
                    nextSteps: 'Technical deep dive and architecture review'
                }
            ];

            // Sample touchpoints
            systemData.touchpoints = [
                {
                    id: 'tp1',
                    contactId: 'demaree',
                    type: 'email',
                    date: '2025-06-10',
                    subject: 'Q3 Business Review Invitation',
                    notes: 'Positive response, meeting scheduled',
                    outcome: 'positive'
                },
                {
                    id: 'tp2',
                    contactId: 'lars',
                    type: 'call',
                    date: '2025-06-08',
                    subject: 'VMware Migration Discussion',
                    notes: 'Interested in cloud migration, sent proposal',
                    outcome: 'positive'
                }
            ];

            // Sample marketing campaigns
            systemData.marketingCampaigns = [
                {
                    id: 'camp1',
                    name: 'Q3 Partner Webinar Series',
                    type: 'webinar',
                    status: 'active',
                    targetAudience: ['tier1', 'tier2'],
                    sentTo: ['demaree', 'lars', 'will'],
                    responses: ['demaree'],
                    metrics: { sent: 25, opened: 18, clicked: 12, registered: 8 }
                },
                {
                    id: 'camp2',
                    name: 'GenAI Solutions Whitepaper',
                    type: 'whitepaper',
                    status: 'sent',
                    targetAudience: ['tier2', 'tier3'],
                    sentTo: ['helen', 'luca'],
                    responses: ['luca'],
                    metrics: { sent: 15, opened: 12, downloaded: 7 }
                }
            ];
        }

        function renderTeams() {
            const container = document.getElementById('teamsContainer');
            container.innerHTML = '';

            Object.keys(teamConfigs).forEach(teamId => {
                if (!systemData.teams[teamId]) systemData.teams[teamId] = [];
                
                const team = systemData.teams[teamId];
                const config = teamConfigs[teamId];
                
                const engagementRate = team.length > 0 ? 
                    Math.round((team.filter(c => c.relationshipScore > 2).length / team.length) * 100) : 0;
                
                const totalPipeline = team.reduce((sum, contact) => {
                    const value = parseFloat(contact.pipelineValue.replace(/[$,K]/g, '')) || 0;
                    return sum + (contact.pipelineValue.includes('K') ? value * 1000 : value);
                }, 0);

                const teamSection = document.createElement('div');
                teamSection.className = 'team-section';
                teamSection.innerHTML = `
                    <div class="team-header">
                        <div class="team-name">${config.name}</div>
                        <div class="team-stats">
                            <span>DM: ${config.dm}</span>
                            <span>PSM: ${config.psm}</span>
                            <span>${team.length} AMs</span>
                            <span>Engagement: ${engagementRate}%</span>
                            <span>Pipeline: ${(totalPipeline/1000).toFixed(0)}K</span>
                        </div>
                    </div>
                    <table class="rep-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Geo</th>
                                <th>Tier</th>
                                <th>Score</th>
                                <th>Last Contact</th>
                                <th>Next Contact</th>
                                <th>Pipeline</th>
                                <th>Key Customers</th>
                                <th>Next Steps</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${team.map(contact => renderContactRow(contact, teamId)).join('')}
                        </tbody>
                    </table>
                `;
                
                container.appendChild(teamSection);
            });
        }

        function renderContactRow(contact, teamId) {
            const customersList = Array.isArray(contact.customers) ? 
                contact.customers.slice(0, 2).join(', ') + (contact.customers.length > 2 ? '...' : '') : 
                contact.customers || '';

            return `
                <tr data-contact="${contact.id}" data-team="${teamId}">
                    <td><strong>${contact.name}</strong></td>
                    <td>${contact.role}</td>
                    <td>${contact.geo}</td>
                    <td><span class="status-badge status-${contact.tier}" onclick="toggleTier(this)">${contact.tier.charAt(0).toUpperCase() + contact.tier.slice(1)}</span></td>
                    <td><span class="relationship-score score-${contact.relationshipScore}" onclick="changeScore(this)">${contact.relationshipScore}</span></td>
                    <td class="editable" contenteditable="true" data-field="lastContact">${contact.lastContact}</td>
                    <td class="editable" contenteditable="true" data-field="nextContact">${contact.nextContact || ''}</td>
                    <td class="editable" contenteditable="true" data-field="pipelineValue">${contact.pipelineValue}</td>
                    <td class="editable" contenteditable="true" data-field="customers" title="${customersList}">${customersList}</td>
                    <td class="editable" contenteditable="true" data-field="nextSteps">${contact.nextSteps}</td>
                    <td>
                        <button class="action-btn" onclick="editContact('${contact.id}', '${teamId}')">Edit</button>
                        <button class="action-btn secondary" onclick="viewContactDetails('${contact.id}', '${teamId}')">Details</button>
                        <button class="action-btn success" onclick="logTouchpoint('${contact.id}')">Log</button>
                    </td>
                </tr>
            `;
        }

        function renderDeals() {
            const container = document.getElementById('dealsContainer');
            if (!container) return;

            container.innerHTML = `
                <table class="rep-table">
                    <thead>
                        <tr>
                            <th>Deal Name</th>
                            <th>Contact/Team</th>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Stage</th>
                            <th>Probability</th>
                            <th>Close Date</th>
                            <th>Next Steps</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${systemData.deals.map(deal => `
                            <tr data-deal="${deal.id}">
                                <td><strong>${deal.name}</strong></td>
                                <td>${getContactName(deal.contactId)} / ${teamConfigs[deal.team]?.name || deal.team}</td>
                                <td><span class="status-badge status-${deal.stage}">${deal.type}</span></td>
                                <td><strong>${(deal.value/1000).toFixed(0)}K</strong></td>
                                <td>${deal.stage}</td>
                                <td>${deal.probability}%</td>
                                <td class="editable" contenteditable="true" data-field="closeDate">${deal.closeDate}</td>
                                <td class="editable" contenteditable="true" data-field="nextSteps">${deal.nextSteps}</td>
                                <td>
                                    <button class="action-btn" onclick="editDeal('${deal.id}')">Edit</button>
                                    <button class="action-btn secondary" onclick="viewDealDetails('${deal.id}')">Details</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderTouchpoints() {
            const container = document.getElementById('touchpointsContainer');
            if (!container) return;

            container.innerHTML = `
                <div class="touchpoint-list">
                    ${systemData.touchpoints.map(tp => `
                        <div class="touchpoint-item">
                            <div>
                                <strong>${getContactName(tp.contactId)}</strong> - ${tp.type}
                                <br><small>${tp.subject}</small>
                            </div>
                            <div>
                                ${tp.date}
                                <button class="action-btn" onclick="editTouchpoint('${tp.id}')">Edit</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderMarketing() {
            const container = document.getElementById('marketingContainer');
            if (!container) return;

            container.innerHTML = `
                <div class="deals-section">
                    <h3>Active Marketing Campaigns</h3>
                    ${systemData.marketingCampaigns.map(campaign => `
                        <div class="deal-item">
                            <div>
                                <strong>${campaign.name}</strong>
                                <span class="status-badge status-${campaign.status}">${campaign.type}</span>
                                <div class="marketing-tags">
                                    <span class="marketing-tag">Sent: ${campaign.metrics?.sent || 0}</span>
                                    <span class="marketing-tag">Opened: ${campaign.metrics?.opened || 0}</span>
                                    <span class="marketing-tag">Responded: ${campaign.responses?.length || 0}</span>
                                </div>
                            </div>
                            <button class="action-btn" onclick="editCampaign('${campaign.id}')">Manage</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderAnalytics() {
            const container = document.getElementById('analyticsContainer');
            if (!container) return;

            // Calculate analytics
            const totalContacts = Object.values(systemData.teams).flat().length;
            const totalPipeline = systemData.deals.reduce((sum, deal) => sum + deal.value, 0);
            const avgDealSize = systemData.deals.length > 0 ? totalPipeline / systemData.deals.length : 0;
            const touchpointsThisWeek = systemData.touchpoints.filter(tp => {
                const tpDate = new Date(tp.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return tpDate >= weekAgo;
            }).length;

            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="deals-section">
                        <h3>Key Metrics</h3>
                        <div class="metric-card">
                            <div class="metric-value">${totalContacts}</div>
                            <div class="metric-label">Total Contacts</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${(totalPipeline/1000000).toFixed(1)}M</div>
                            <div class="metric-label">Total Pipeline</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${(avgDealSize/1000).toFixed(0)}K</div>
                            <div class="metric-label">Avg Deal Size</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${touchpointsThisWeek}</div>
                            <div class="metric-label">Touchpoints This Week</div>
                        </div>
                    </div>
                    
                    <div class="deals-section">
                        <h3>Team Performance</h3>
                        ${Object.keys(teamConfigs).map(teamId => {
                            const team = systemData.teams[teamId] || [];
                            const teamPipeline = team.reduce((sum, contact) => {
                                const value = parseFloat(contact.pipelineValue.replace(/[$,K]/g, '')) || 0;
                                return sum + (contact.pipelineValue.includes('K') ? value * 1000 : value);
                            }, 0);
                            return `
                                <div class="deal-item">
                                    <span>${teamConfigs[teamId].name}</span>
                                    <span>${(teamPipeline/1000).toFixed(0)}K</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function calculateMetrics() {
            const allContacts = Object.values(systemData.teams).flat();
            
            // Engagement rate
            const engagedContacts = allContacts.filter(c => c.relationshipScore > 2).length;
            const engagementRate = allContacts.length > 0 ? Math.round((engagedContacts / allContacts.length) * 100) : 0;
            
            // Pipeline value
            const totalPipeline = systemData.deals.reduce((sum, deal) => sum + deal.value, 0);
            
            // Active deals count
            const activeDeals = systemData.deals.filter(deal => 
                !['closed-won', 'closed-lost'].includes(deal.stage)
            ).length;
            
            // Weekly touchpoints
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weeklyTouchpoints = systemData.touchpoints.filter(tp => 
                new Date(tp.date) >= weekAgo
            ).length;
            
            // Active marketing campaigns
            const activeCampaigns = systemData.marketingCampaigns.filter(c => 
                ['active', 'sent'].includes(c.status)
            ).length;
            
            // Coverage ratio (placeholder calculation)
            const coverageRatio = totalPipeline > 0 ? (totalPipeline / 2900000) : 0;
            
            // Update dashboard
            document.getElementById('engagementRate').textContent = `${engagementRate}%`;
            document.getElementById('pipelineValue').textContent = `${(totalPipeline/1000000).toFixed(1)}M`;
            document.getElementById('activeDeals').textContent = activeDeals;
            document.getElementById('weeklyTouchpoints').textContent = weeklyTouchpoints;
            document.getElementById('marketingCampaigns').textContent = activeCampaigns;
            document.getElementById('coverageRatio').textContent = `${coverageRatio.toFixed(1)}x`;
        }

        // Enhanced event listeners setup
        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchInput')?.addEventListener('input', filterContacts);
            
            // Filter functionality
            document.getElementById('teamFilter')?.addEventListener('change', filterContacts);
            document.getElementById('tierFilter')?.addEventListener('change', filterContacts);
            
            // Editable field updates for deals
            document.addEventListener('blur', function(e) {
                if (e.target.classList.contains('editable')) {
                    if (e.target.dataset.dealId) {
                        updateDealField(e.target);
                    } else {
                        updateContactField(e.target);
                    }
                }
            }, true);
            
            // Form submissions
            document.getElementById('contactForm')?.addEventListener('submit', handleContactFormSubmit);
            document.getElementById('dealForm')?.addEventListener('submit', handleDealFormSubmit);
            document.getElementById('touchpointForm')?.addEventListener('submit', handleTouchpointFormSubmit);
            document.getElementById('followUpForm')?.addEventListener('submit', handleFollowUpFormSubmit);
            document.getElementById('bulkActionsForm')?.addEventListener('submit', handleBulkActionsSubmit);
        }

        function updateDealField(element) {
            const field = element.dataset.field;
            const value = element.textContent.trim();
            const dealId = element.dataset.dealId;
            
            if (!dealId || !field) return;
            
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal && deal[field] !== undefined) {
                deal[field] = value;
                deal.lastUpdated = new Date().toISOString().split('T')[0];
                saveData();
                showNotification(`Deal ${field} updated`);
                calculateMetrics();
            }
        }

        // Enhanced modal functions
        function openModal(modalType, data = {}) {
            let modal, form;
            
            switch(modalType) {
                case 'addContact':
                case 'editContact':
                    modal = document.getElementById('contactModal');
                    form = document.getElementById('contactForm');
                    document.getElementById('contactModalTitle').textContent = 
                        modalType === 'addContact' ? 'Add New Contact' : 'Edit Contact';
                    
                    if (modalType === 'editContact' && data.contact) {
                        populateContactForm(data.contact);
                    } else {
                        form.reset();
                        document.getElementById('lastContact').value = new Date().toISOString().split('T')[0];
                    }
                    break;
                    
                case 'dealModal':
                    modal = document.getElementById('dealModal');
                    form = document.getElementById('dealForm');
                    document.getElementById('dealModalTitle').textContent = 
                        data.mode === 'add' ? 'Add New Deal' : 'Edit Deal';
                    
                    // Populate contact dropdown
                    populateContactDropdown();
                    
                    if (data.mode === 'edit' && data.deal) {
                        populateDealForm(data.deal);
                    } else {
                        form.reset();
                        // Set default close date to 30 days from now
                        const futureDate = new Date();
                        futureDate.setDate(futureDate.getDate() + 30);
                        document.getElementById('dealCloseDate').value = futureDate.toISOString().split('T')[0];
                    }
                    break;
                    
                case 'touchpointModal':
                    modal = document.getElementById('touchpointModal');
                    form = document.getElementById('touchpointForm');
                    document.getElementById('touchpointModalTitle').textContent = 
                        data.mode === 'add' ? 'Log Touchpoint' : 'Edit Touchpoint';
                    
                    if (data.mode !== 'edit') {
                        form.reset();
                    }
                    break;
                    
                case 'followUpModal':
                    modal = document.getElementById('followUpModal');
                    form = document.getElementById('followUpForm');
                    form.reset();
                    break;
                    
                case 'bulkActionsModal':
                    modal = document.getElementById('bulkActionsModal');
                    form = document.getElementById('bulkActionsForm');
                    form.reset();
                    toggleBulkActionFields('');
                    break;
                    
                case 'campaignAnalyticsModal':
                    modal = document.getElementById('campaignAnalyticsModal');
                    break;
                    
                case 'dealDetailsModal':
                    modal = document.getElementById('dealDetailsModal');
                    break;
                    
                default:
                    showNotification(`${modalType} modal not implemented yet`);
                    return;
            }
            
            if (modal) {
                modal.style.display = 'block';
            }
        }

        function populateContactDropdown() {
            const dropdown = document.getElementById('dealContact');
            dropdown.innerHTML = '<option value="">Select Contact</option>';
            
            Object.keys(systemData.teams).forEach(teamId => {
                systemData.teams[teamId].forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = `${contact.name} (${teamConfigs[teamId].name})`;
                    dropdown.appendChild(option);
                });
            });
        }

        function populateDealForm(deal) {
            document.getElementById('dealId').value = deal.id;
            document.getElementById('dealName').value = deal.name;
            document.getElementById('dealValue').value = deal.value;
            document.getElementById('dealContact').value = deal.contactId;
            document.getElementById('dealTeam').value = deal.team;
            document.getElementById('dealStage').value = deal.stage;
            document.getElementById('dealProbability').value = deal.probability;
            document.getElementById('dealCloseDate').value = deal.closeDate;
            document.getElementById('dealType').value = deal.type || '';
            document.getElementById('dealDescription').value = deal.description || '';
            document.getElementById('dealNextSteps').value = deal.nextSteps || '';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function filterContacts() {
            const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const teamFilter = document.getElementById('teamFilter')?.value || '';
            const tierFilter = document.getElementById('tierFilter')?.value || '';
            
            document.querySelectorAll('.rep-table tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                const team = row.dataset.team;
                const tier = row.querySelector('.status-badge')?.textContent.toLowerCase() || '';
                
                const matchesSearch = search === '' || text.includes(search);
                const matchesTeam = teamFilter === '' || team === teamFilter;
                const matchesTier = tierFilter === '' || tier.includes(tierFilter);
                
                row.style.display = (matchesSearch && matchesTeam && matchesTier) ? '' : 'none';
            });
        }

        function updateContactField(element) {
            const field = element.dataset.field;
            const value = element.textContent.trim();
            const row = element.closest('tr');
            const contactId = row.dataset.contact;
            const teamId = row.dataset.team;
            
            if (!contactId || !teamId || !field) return;
            
            const contact = systemData.teams[teamId]?.find(c => c.id === contactId);
            if (contact && contact[field] !== undefined) {
                contact[field] = value;
                saveData();
                showNotification(`${field} updated for ${contact.name}`);
                calculateMetrics();
            }
        }

        function getContactName(contactId) {
            for (let teamId in systemData.teams) {
                const contact = systemData.teams[teamId].find(c => c.id === contactId);
                if (contact) return contact.name;
            }
            return 'Unknown Contact';
        }

        // Modal functions
        function openModal(modalType, data = {}) {
            let modal, form;
            
            switch(modalType) {
                case 'addContact':
                case 'editContact':
                    modal = document.getElementById('contactModal');
                    form = document.getElementById('contactForm');
                    document.getElementById('contactModalTitle').textContent = 
                        modalType === 'addContact' ? 'Add New Contact' : 'Edit Contact';
                    
                    if (modalType === 'editContact' && data.contact) {
                        populateContactForm(data.contact);
                    } else {
                        form.reset();
                        document.getElementById('lastContact').value = new Date().toISOString().split('T')[0];
                    }
                    break;
                    
                default:
                    showNotification(`${modalType} modal not implemented yet`);
                    return;
            }
            
            if (modal) {
                modal.style.display = 'block';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function populateContactForm(contact) {
            Object.keys(contact).forEach(key => {
                const field = document.getElementById(`contact${key.charAt(0).toUpperCase() + key.slice(1)}`);
                if (field) {
                    field.value = contact[key];
                }
            });
        }

        function handleContactFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const contact = Object.fromEntries(formData.entries());
            
            // Generate ID if new contact
            if (!contact.id) {
                contact.id = contact.name.toLowerCase().replace(/\s+/g, '');
            }
            
            // Add additional fields
            contact.touchpoints = [];
            contact.deals = [];
            contact.marketingStatus = {};
            contact.relationshipScore = parseInt(contact.relationshipScore);
            contact.customers = contact.customers ? contact.customers.split(',').map(c => c.trim()) : [];
            
            // Add to appropriate team
            const teamId = contact.team;
            if (!systemData.teams[teamId]) {
                systemData.teams[teamId] = [];
            }
            
            const existingIndex = systemData.teams[teamId].findIndex(c => c.id === contact.id);
            if (existingIndex >= 0) {
                systemData.teams[teamId][existingIndex] = contact;
                showNotification(`Contact ${contact.name} updated successfully`);
            } else {
                systemData.teams[teamId].push(contact);
                showNotification(`Contact ${contact.name} added successfully`);
            }
            
            saveData();
            renderTeams();
            calculateMetrics();
            closeModal('contactModal');
        }

        // Action functions
        function editContact(contactId, teamId) {
            const contact = systemData.teams[teamId]?.find(c => c.id === contactId);
            if (contact) {
                openModal('editContact', { contact });
            }
        }

        function viewContactDetails(contactId, teamId) {
            showNotification(`Detailed view for ${contactId} not implemented yet`);
        }

        function logTouchpoint(contactId) {
            showNotification(`Touchpoint logging for ${contactId} not implemented yet`);
        }

        function toggleTier(element) {
            const tiers = ['tier1', 'tier2', 'tier3'];
            const tierLabels = ['Tier 1', 'Tier 2', 'Tier 3'];
            const currentTier = element.textContent.toLowerCase().replace(' ', '');
            const currentIndex = tiers.indexOf(currentTier);
            const nextIndex = (currentIndex + 1) % tiers.length;
            
            element.className = `status-badge status-${tiers[nextIndex]}`;
            element.textContent = tierLabels[nextIndex];
            
            // Update data
            const row = element.closest('tr');
            const contactId = row.dataset.contact;
            const teamId = row.dataset.team;
            const contact = systemData.teams[teamId]?.find(c => c.id === contactId);
            if (contact) {
                contact.tier = tiers[nextIndex];
                saveData();
                calculateMetrics();
            }
            
            showNotification('Tier updated');
        }

        function changeScore(element) {
            let currentScore = parseInt(element.textContent);
            currentScore = currentScore >= 5 ? 1 : currentScore + 1;
            
            element.textContent = currentScore;
            element.className = `relationship-score score-${currentScore}`;
            
            // Update data
            const row = element.closest('tr');
            const contactId = row.dataset.contact;
            const teamId = row.dataset.team;
            const contact = systemData.teams[teamId]?.find(c => c.id === contactId);
            if (contact) {
                contact.relationshipScore = currentScore;
                saveData();
                calculateMetrics();
            }
            
            showNotification('Relationship score updated');
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => 
                content.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => 
                tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Render content based on tab
            switch(tabName) {
                case 'teams':
                    renderTeams();
                    break;
                case 'deals':
                    renderDeals();
                    break;
                case 'touchpoints':
                    renderTouchpoints();
                    break;
                case 'marketing':
                    renderMarketing();
                    break;
                case 'analytics':
                    renderAnalytics();
                    break;
            }
        }

        // Utility functions
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = now.toLocaleString();
            systemData.lastUpdated = now;
        }

        function saveData() {
            try {
                updateLastUpdated();
                sessionStorage.setItem('awsPartnerSystemData', JSON.stringify(systemData));
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        function loadSavedData() {
            try {
                const saved = sessionStorage.getItem('awsPartnerSystemData');
                if (saved) {
                    systemData = { ...systemData, ...JSON.parse(saved) };
                }
            } catch (error) {
                console.error('Error loading saved data:', error);
            }
        }

        function showNotification(message, duration = 3000, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            const colors = {
                success: '#28a745',
                warning: '#ffc107',
                error: '#dc3545',
                info: '#17a2b8'
            };
            
            notification.style.background = colors[type] || colors.success;
            text.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function showMetricDetail(metric) {
            let message = '';
            switch(metric) {
                case 'engagement':
                    message = 'Engagement rate shows percentage of AMs actively responding to outreach efforts';
                    break;
                case 'pipeline':
                    message = 'Active pipeline value represents total potential revenue from all opportunities';
                    break;
                case 'deals':
                    message = 'Active deals are qualified opportunities currently in progress';
                    break;
                case 'touchpoints':
                    message = 'Weekly touchpoints track all interactions with partners in the last 7 days';
                    break;
                case 'marketing':
                    message = 'Active marketing campaigns currently running or recently sent';
                    break;
                case 'coverage':
                    message = 'Pipeline coverage shows ratio of pipeline value to annual quota target';
                    break;
            }
            showNotification(message, 5000, 'info');
        }

        // Export functions
        function exportAllData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                version: '2.0',
                data: systemData
            };
            
            const jsonStr = JSON.stringify(exportData, null, 2);
            downloadFile(jsonStr, `aws_partner_system_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
        }

        function exportDeals() {
            let csv = 'Deal Name,Contact,Team,Type,Value,Stage,Probability,Close Date,Description,Next Steps\n';
            
            systemData.deals.forEach(deal => {
                const contactName = getContactName(deal.contactId);
                const teamName = teamConfigs[deal.team]?.name || deal.team;
                csv += `"${deal.name}","${contactName}","${teamName}","${deal.type}",${deal.value},"${deal.stage}",${deal.probability},"${deal.closeDate}","${deal.description}","${deal.nextSteps}"\n`;
            });
            
            downloadFile(csv, 'aws_deals_export.csv', 'text/csv');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification(`${filename} downloaded successfully`);
        }

        // Deal stage configuration
        const dealStages = [
            { id: 'prequalified', name: 'Prequalified', color: '#6c757d' },
            { id: 'qualified', name: 'Qualified', color: '#17a2b8' },
            { id: 'proposal-development', name: 'Proposal Development', color: '#ffc107' },
            { id: 'proposal-delivered', name: 'Proposal Delivered', color: '#fd7e14' },
            { id: 'legal', name: 'Legal Review', color: '#6f42c1' },
            { id: 'out-for-signature', name: 'Out for Signature', color: '#20c997' },
            { id: 'signed', name: 'Signed', color: '#28a745' },
            { id: 'deal-won', name: 'Deal Won', color: '#28a745' },
            { id: 'deal-lost', name: 'Deal Lost', color: '#dc3545' }
        ];

        // Enhanced deal management functions
        function addDeal() {
            openModal('dealModal', { mode: 'add' });
        }

        function editDeal(dealId) {
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal) {
                openModal('dealModal', { mode: 'edit', deal });
            }
        }

        function viewDealDetails(dealId) {
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal) {
                openModal('dealDetailsModal', { deal });
            }
        }

        function handleDealFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const deal = Object.fromEntries(formData.entries());
            
            // Convert value to number
            deal.value = parseFloat(deal.value.replace(/[$,]/g, '')) || 0;
            deal.probability = parseInt(deal.probability) || 0;
            
            if (!deal.id) {
                deal.id = 'deal_' + Date.now();
                deal.createdDate = new Date().toISOString().split('T')[0];
            }
            
            const existingIndex = systemData.deals.findIndex(d => d.id === deal.id);
            if (existingIndex >= 0) {
                systemData.deals[existingIndex] = { ...systemData.deals[existingIndex], ...deal };
                showNotification(`Deal "${deal.name}" updated successfully`);
            } else {
                systemData.deals.push(deal);
                showNotification(`Deal "${deal.name}" added successfully`);
            }
            
            saveData();
            renderDeals();
            calculateMetrics();
            closeModal('dealModal');
        }

        function changeDealStage(dealId, newStage) {
            const deal = systemData.deals.find(d => d.id === dealId);
            if (deal) {
                deal.stage = newStage;
                deal.lastUpdated = new Date().toISOString().split('T')[0];
                
                // Auto-update probability based on stage
                const stageProbabilities = {
                    'prequalified': 10,
                    'qualified': 25,
                    'proposal-development': 40,
                    'proposal-delivered': 60,
                    'legal': 75,
                    'out-for-signature': 90,
                    'signed': 95,
                    'deal-won': 100,
                    'deal-lost': 0
                };
                
                deal.probability = stageProbabilities[newStage] || deal.probability;
                
                saveData();
                renderDeals();
                calculateMetrics();
                showNotification(`Deal moved to ${dealStages.find(s => s.id === newStage)?.name}`);
            }
        }

        // Touchpoint management functions
        function logTouchpoint(contactId) {
            openModal('touchpointModal', { mode: 'add', contactId });
        }

        function editTouchpoint(touchpointId) {
            const touchpoint = systemData.touchpoints.find(tp => tp.id === touchpointId);
            if (touchpoint) {
                openModal('touchpointModal', { mode: 'edit', touchpoint });
            }
        }

        function handleTouchpointFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const touchpoint = Object.fromEntries(formData.entries());
            
            if (!touchpoint.id) {
                touchpoint.id = 'tp_' + Date.now();
            }
            
            const existingIndex = systemData.touchpoints.findIndex(tp => tp.id === touchpoint.id);
            if (existingIndex >= 0) {
                systemData.touchpoints[existingIndex] = { ...systemData.touchpoints[existingIndex], ...touchpoint };
                showNotification('Touchpoint updated successfully');
            } else {
                systemData.touchpoints.push(touchpoint);
                showNotification('Touchpoint logged successfully');
            }
            
            saveData();
            renderTouchpoints();
            calculateMetrics();
            closeModal('touchpointModal');
        }

        // Follow-up scheduling
        function scheduleFollowUp(contactId) {
            openModal('followUpModal', { contactId });
        }

        function handleFollowUpFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const followUp = Object.fromEntries(formData.entries());
            
            // Create a future touchpoint
            const touchpoint = {
                id: 'fu_' + Date.now(),
                contactId: followUp.contactId,
                type: followUp.type,
                date: followUp.date,
                subject: followUp.subject,
                notes: followUp.notes,
                status: 'scheduled'
            };
            
            systemData.touchpoints.push(touchpoint);
            
            // Update contact's next contact date
            for (let teamId in systemData.teams) {
                const contact = systemData.teams[teamId].find(c => c.id === followUp.contactId);
                if (contact) {
                    contact.nextContact = followUp.date;
                    break;
                }
            }
            
            saveData();
            renderTouchpoints();
            renderTeams();
            calculateMetrics();
            closeModal('followUpModal');
            showNotification('Follow-up scheduled successfully');
        }

        // Bulk actions implementation
        function bulkActions() {
            openModal('bulkActionsModal');
        }

        function handleBulkActionsSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const action = formData.get('action');
            const selectedContacts = Array.from(document.querySelectorAll('.contact-checkbox:checked'))
                .map(cb => ({ contactId: cb.dataset.contactId, teamId: cb.dataset.teamId }));
            
            if (selectedContacts.length === 0) {
                showNotification('Please select contacts first', 3000, 'warning');
                return;
            }
            
            selectedContacts.forEach(({ contactId, teamId }) => {
                const contact = systemData.teams[teamId]?.find(c => c.id === contactId);
                if (contact) {
                    switch (action) {
                        case 'updateTier':
                            contact.tier = formData.get('newTier');
                            break;
                        case 'addNote':
                            contact.notes = (contact.notes || '') + '\n' + formData.get('note');
                            break;
                        case 'scheduleFollowUp':
                            contact.nextContact = formData.get('followUpDate');
                            break;
                    }
                }
            });
            
            saveData();
            renderTeams();
            calculateMetrics();
            closeModal('bulkActionsModal');
            showNotification(`Bulk action applied to ${selectedContacts.length} contacts`);
        }

        // Campaign analytics
        function campaignAnalytics() {
            openModal('campaignAnalyticsModal');
            renderCampaignAnalytics();
        }

        function renderCampaignAnalytics() {
            const container = document.getElementById('campaignAnalyticsContent');
            if (!container) return;

            const analytics = systemData.marketingCampaigns.map(campaign => {
                const responseRate = campaign.metrics?.sent > 0 ? 
                    ((campaign.responses?.length || 0) / campaign.metrics.sent * 100).toFixed(1) : 0;
                const openRate = campaign.metrics?.sent > 0 ? 
                    ((campaign.metrics.opened || 0) / campaign.metrics.sent * 100).toFixed(1) : 0;
                
                return {
                    ...campaign,
                    responseRate,
                    openRate
                };
            });

            container.innerHTML = `
                <table class="rep-table">
                    <thead>
                        <tr>
                            <th>Campaign</th>
                            <th>Type</th>
                            <th>Sent</th>
                            <th>Opened</th>
                            <th>Responses</th>
                            <th>Open Rate</th>
                            <th>Response Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${analytics.map(campaign => `
                            <tr>
                                <td><strong>${campaign.name}</strong></td>
                                <td>${campaign.type}</td>
                                <td>${campaign.metrics?.sent || 0}</td>
                                <td>${campaign.metrics?.opened || 0}</td>
                                <td>${campaign.responses?.length || 0}</td>
                                <td>${campaign.openRate}%</td>
                                <td>${campaign.responseRate}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function showAnalytics() {
            showTab('analytics');
        }

        function editCampaign(campaignId) {
            showNotification(`Campaign editing for ${campaignId} coming soon`, 3000, 'info');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveData();
                showNotification('Data saved manually');
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
            
            // Ctrl/Cmd + N to add new contact
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openModal('addContact');
            }
        });

        // Initialize the system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            initializeSystem();
            
            console.log('AWS Partner Management System loaded successfully');
            showNotification('System loaded - Data auto-saves every 30 seconds', 4000, 'info');
            
            // Performance tracking
            const loadTime = performance.now();
            console.log(`System loaded in ${loadTime.toFixed(2)}ms`);
        });

        // Real-time updates simulation
        setInterval(() => {
            const metrics = document.querySelectorAll('.metric-value');
            metrics.forEach(metric => {
                if (Math.random() > 0.995) {
                    metric.style.transform = 'scale(1.05)';
                    metric.style.color = '#FF9900';
                    setTimeout(() => {
                        metric.style.transform = 'scale(1)';
                        metric.style.color = '';
                    }, 300);
                }
            });
        }, 5000);

    </script>
</body>
</html>
            
